<!doctype html>

<html>
<head>
  <link rel="shortcut icon" href="static/images/favicon.ico" type="image/x-icon">
  <title>sha2_64bit_test.js (Closure Library API Documentation - JavaScript)</title>
  <link rel="stylesheet" href="static/css/base.css">
  <link rel="stylesheet" href="static/css/doc.css">
  <link rel="stylesheet" href="static/css/sidetree.css">
  <link rel="stylesheet" href="static/css/prettify.css">

  <script>
     var _staticFilePath = "static/";
     var _typeTreeName = "goog";
     var _fileTreeName = "Source";
  </script>

  <script src="static/js/doc.js">
  </script>


  <meta charset="utf8">
</head>

<body onload="grokdoc.onLoad();">

<div id="header">
  <div class="g-section g-tpl-50-50 g-split">
    <div class="g-unit g-first">
      <a id="logo" href="index.html">Closure Library API Documentation</a>
    </div>

    <div class="g-unit">
      <div class="g-c">
        <strong>Go to class or file:</strong>
        <input type="text" id="ac">
      </div>
    </div>
  </div>
</div>

<div class="clear"></div>

<h2><a href="local_closure_goog_crypt_sha2_64bit_test.js.html">sha2_64bit_test.js</a></h2>

<pre class="prettyprint lang-js">
<a name="line1"></a>// Copyright 2014 The Closure Library Authors. All Rights Reserved.
<a name="line2"></a>//
<a name="line3"></a>// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<a name="line4"></a>// you may not use this file except in compliance with the License.
<a name="line5"></a>// You may obtain a copy of the License at
<a name="line6"></a>//
<a name="line7"></a>//      http://www.apache.org/licenses/LICENSE-2.0
<a name="line8"></a>//
<a name="line9"></a>// Unless required by applicable law or agreed to in writing, software
<a name="line10"></a>// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
<a name="line11"></a>// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<a name="line12"></a>// See the License for the specific language governing permissions and
<a name="line13"></a>// limitations under the License.
<a name="line14"></a>
<a name="line15"></a>goog.provide(&#39;goog.crypt.Sha2_64bit_test&#39;);
<a name="line16"></a>goog.setTestOnly(&#39;goog.crypt.Sha2_64bit_test&#39;);
<a name="line17"></a>
<a name="line18"></a>goog.require(&#39;goog.array&#39;);
<a name="line19"></a>goog.require(&#39;goog.crypt&#39;);
<a name="line20"></a>goog.require(&#39;goog.crypt.Sha384&#39;);
<a name="line21"></a>goog.require(&#39;goog.crypt.Sha512&#39;);
<a name="line22"></a>goog.require(&#39;goog.crypt.Sha512_256&#39;);
<a name="line23"></a>goog.require(&#39;goog.crypt.hashTester&#39;);
<a name="line24"></a>goog.require(&#39;goog.testing.jsunit&#39;);
<a name="line25"></a>goog.require(&#39;goog.userAgent&#39;);
<a name="line26"></a>
<a name="line27"></a>
<a name="line28"></a>/**
<a name="line29"></a> * Each object in the test vector array is a source text and one or more
<a name="line30"></a> * hashes of that source text.  The source text is either a string or a
<a name="line31"></a> * byte array.
<a name="line32"></a> * &lt;p&gt;
<a name="line33"></a> * All hash values, except for the empty string, are from public sources:
<a name="line34"></a> *   csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf
<a name="line35"></a> *   csrc.nist.gov/groups/ST/toolkit/documents/Examples/SHA384.pdf
<a name="line36"></a> *   csrc.nist.gov/groups/ST/toolkit/documents/Examples/SHA512_256.pdf
<a name="line37"></a> *   csrc.nist.gov/groups/ST/toolkit/documents/Examples/SHA2_Additional.pdf
<a name="line38"></a> *   en.wikipedia.org/wiki/SHA-2#Examples_of_SHA-2_variants
<a name="line39"></a> */
<a name="line40"></a>var TEST_VECTOR = [
<a name="line41"></a>  {
<a name="line42"></a>    // Make sure the algorithm correctly handles the empty string
<a name="line43"></a>    source:
<a name="line44"></a>        &#39;&#39;,
<a name="line45"></a>    512:
<a name="line46"></a>        &#39;cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce&#39; +
<a name="line47"></a>        &#39;47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e&#39;
<a name="line48"></a>  },
<a name="line49"></a>  {
<a name="line50"></a>    source:
<a name="line51"></a>        &#39;abc&#39;,
<a name="line52"></a>    512:
<a name="line53"></a>        &#39;ddaf35a193617abacc417349ae20413112e6fa4e89a97ea20a9eeee64b55d39a&#39; +
<a name="line54"></a>        &#39;2192992a274fc1a836ba3c23a3feebbd454d4423643ce80e2a9ac94fa54ca49f&#39;,
<a name="line55"></a>    384:
<a name="line56"></a>        &#39;cb00753f45a35e8bb5a03d699ac65007272c32ab0eded163&#39; +
<a name="line57"></a>        &#39;1a8b605a43ff5bed8086072ba1e7cc2358baeca134c825a7&#39;,
<a name="line58"></a>    256:
<a name="line59"></a>        &#39;53048e2681941ef99b2e29b76b4c7dabe4c2d0c634fc6d46e0e2f13107e7af23&#39;
<a name="line60"></a>  },
<a name="line61"></a>  {
<a name="line62"></a>    source:
<a name="line63"></a>        &#39;abcdefghbcdefghicdefghijdefghijkefghijklfghijklmghijklmn&#39; +
<a name="line64"></a>        &#39;hijklmnoijklmnopjklmnopqklmnopqrlmnopqrsmnopqrstnopqrstu&#39;,
<a name="line65"></a>    512:
<a name="line66"></a>        &#39;8e959b75dae313da8cf4f72814fc143f8f7779c6eb9f7fa17299aeadb6889018&#39; +
<a name="line67"></a>        &#39;501d289e4900f7e4331b99dec4b5433ac7d329eeb6dd26545e96e55b874be909&#39;,
<a name="line68"></a>    384:
<a name="line69"></a>        &#39;09330c33f71147e83d192fc782cd1b4753111b173b3b05d2&#39; +
<a name="line70"></a>        &#39;2fa08086e3b0f712fcc7c71a557e2db966c3e9fa91746039&#39;,
<a name="line71"></a>    256:
<a name="line72"></a>        &#39;3928e184fb8690f840da3988121d31be65cb9d3ef83ee6146feac861e19b563a&#39;
<a name="line73"></a>  },
<a name="line74"></a>  {
<a name="line75"></a>    source:
<a name="line76"></a>        &#39;The quick brown fox jumps over the lazy dog&#39;,
<a name="line77"></a>    512:
<a name="line78"></a>        &#39;07e547d9586f6a73f73fbac0435ed76951218fb7d0c8d788a309d785436bbb64&#39; +
<a name="line79"></a>        &#39;2e93a252a954f23912547d1e8a3b5ed6e1bfd7097821233fa0538f3db854fee6&#39;,
<a name="line80"></a>    384:
<a name="line81"></a>        &#39;ca737f1014a48f4c0b6dd43cb177b0afd9e5169367544c49&#39; +
<a name="line82"></a>        &#39;4011e3317dbf9a509cb1e5dc1e85a941bbee3d7f2afbc9b1&#39;,
<a name="line83"></a>    256:
<a name="line84"></a>        &#39;dd9d67b371519c339ed8dbd25af90e976a1eeefd4ad3d889005e532fc5bef04d&#39;
<a name="line85"></a>  }
<a name="line86"></a>];
<a name="line87"></a>
<a name="line88"></a>
<a name="line89"></a>/**
<a name="line90"></a> * For each integer key N, the value is the SHA-512 value of a string
<a name="line91"></a> * consisting of N repetitions of the character &#39;a&#39;.
<a name="line92"></a> */
<a name="line93"></a>var TEST_FENCEPOST_VECTOR = {
<a name="line94"></a>  110:
<a name="line95"></a>      &#39;c825949632e509824543f7eaf159fb6041722fce3c1cdcbb613b3d37ff107c51&#39; +
<a name="line96"></a>      &#39;9417baac32f8e74fe29d7f4823bf6886956603dca5354a6ed6e4a542e06b7d28&#39;,
<a name="line97"></a>  111:
<a name="line98"></a>      &#39;fa9121c7b32b9e01733d034cfc78cbf67f926c7ed83e82200ef8681819692176&#39; +
<a name="line99"></a>      &#39;0b4beff48404df811b953828274461673c68d04e297b0eb7b2b4d60fc6b566a2&#39;,
<a name="line100"></a>  112:
<a name="line101"></a>      &#39;c01d080efd492776a1c43bd23dd99d0a2e626d481e16782e75d54c2503b5dc32&#39; +
<a name="line102"></a>      &#39;bd05f0f1ba33e568b88fd2d970929b719ecbb152f58f130a407c8830604b70ca&#39;,
<a name="line103"></a>  113:
<a name="line104"></a>      &#39;55ddd8ac210a6e18ba1ee055af84c966e0dbff091c43580ae1be703bdb85da31&#39; +
<a name="line105"></a>      &#39;acf6948cf5bd90c55a20e5450f22fb89bd8d0085e39f85a86cc46abbca75e24d&#39;
<a name="line106"></a>};
<a name="line107"></a>
<a name="line108"></a>
<a name="line109"></a>/**
<a name="line110"></a> * Simple sanity tests for hash functions.
<a name="line111"></a> */
<a name="line112"></a>function testBasicOperations() {
<a name="line113"></a>  var sha512 = new goog.crypt.Sha512();
<a name="line114"></a>  goog.crypt.hashTester.runBasicTests(sha512);
<a name="line115"></a>
<a name="line116"></a>  var sha384 = new goog.crypt.Sha384();
<a name="line117"></a>  goog.crypt.hashTester.runBasicTests(sha384);
<a name="line118"></a>
<a name="line119"></a>  var sha256 = new goog.crypt.Sha512_256();
<a name="line120"></a>  goog.crypt.hashTester.runBasicTests(sha256);
<a name="line121"></a>}
<a name="line122"></a>
<a name="line123"></a>
<a name="line124"></a>/**
<a name="line125"></a> * Function called by the actual testers to ensure that specific strings
<a name="line126"></a> * hash to specific published values.
<a name="line127"></a> *
<a name="line128"></a> * Each item in the vector has a &quot;source&quot; and one or more additional keys.
<a name="line129"></a> * If the item has a key matching the key argument passed to this
<a name="line130"></a> * function, it is the expected value of the hash function.
<a name="line131"></a> *
<a name="line132"></a> * @param {!goog.crypt.Sha2_64bit} hasher The hasher to test
<a name="line133"></a> * @param {number} length The length of the resulting hash, in bits.
<a name="line134"></a> *     Also the key to use in TEST_VECTOR for the expected hash value
<a name="line135"></a> */
<a name="line136"></a>function hashGoldenTester(hasher, length) {
<a name="line137"></a>  goog.array.forEach(TEST_VECTOR, function(data) {
<a name="line138"></a>    hasher.update(data.source);
<a name="line139"></a>    var digest = hasher.digest();
<a name="line140"></a>    assertEquals(&#39;Hash digest has the wrong length&#39;, length, digest.length * 8);
<a name="line141"></a>    if (data[length]) {
<a name="line142"></a>      // We&#39;re given an expected value
<a name="line143"></a>      var expected = goog.crypt.hexToByteArray(data[length]);
<a name="line144"></a>      assertElementsEquals(
<a name="line145"></a>          &#39;Wrong result for hash&#39; + length + &#39;(\&#39;&#39; + data.source + &#39;\&#39;)&#39;,
<a name="line146"></a>          expected, digest);
<a name="line147"></a>    }
<a name="line148"></a>    hasher.reset();
<a name="line149"></a>  });
<a name="line150"></a>}
<a name="line151"></a>
<a name="line152"></a>
<a name="line153"></a>/** Test that Sha512() returns the published values */
<a name="line154"></a>function testHashing512() {
<a name="line155"></a>  hashGoldenTester(new goog.crypt.Sha512(), 512);
<a name="line156"></a>}
<a name="line157"></a>
<a name="line158"></a>
<a name="line159"></a>/** Test that Sha384 returns the published values */
<a name="line160"></a>function testHashing384() {
<a name="line161"></a>  hashGoldenTester(new goog.crypt.Sha384(), 384);
<a name="line162"></a>}
<a name="line163"></a>
<a name="line164"></a>
<a name="line165"></a>/** Test that Sha512_256 returns the published values */
<a name="line166"></a>function testHashing256() {
<a name="line167"></a>  hashGoldenTester(new goog.crypt.Sha512_256(), 256);
<a name="line168"></a>}
<a name="line169"></a>
<a name="line170"></a>
<a name="line171"></a>/** Test that the opt_length works */
<a name="line172"></a>function testHashing_optLength() {
<a name="line173"></a>  var hasher = new goog.crypt.Sha512();
<a name="line174"></a>  hasher.update(&#39;1234567890&#39;);
<a name="line175"></a>  var digest1 = hasher.digest();
<a name="line176"></a>  hasher.reset();
<a name="line177"></a>  hasher.update(&#39;12345678901234567890&#39;, 10);
<a name="line178"></a>  var digest2 = hasher.digest();
<a name="line179"></a>  assertElementsEquals(digest1, digest2);
<a name="line180"></a>}
<a name="line181"></a>
<a name="line182"></a>
<a name="line183"></a>/**
<a name="line184"></a> * Make sure that we correctly handle strings whose length is 110-113.
<a name="line185"></a> * This is the area where we are likely to hit fencepost errors in the padding
<a name="line186"></a> * code.
<a name="line187"></a> */
<a name="line188"></a>function testFencepostErrors() {
<a name="line189"></a>  var hasher = new goog.crypt.Sha512();
<a name="line190"></a>  A64 = &#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;;
<a name="line191"></a>  A128 = A64 + A64;
<a name="line192"></a>  for (var i = 110; i &lt;= 113; i++) {
<a name="line193"></a>    hasher.update(A128, i);
<a name="line194"></a>    var digest = hasher.digest();
<a name="line195"></a>    var expected = goog.crypt.hexToByteArray(TEST_FENCEPOST_VECTOR[i]);
<a name="line196"></a>    assertElementsEquals(&#39;Fencepost &#39; + i, expected, digest);
<a name="line197"></a>    hasher.reset();
<a name="line198"></a>  }
<a name="line199"></a>}
<a name="line200"></a>
<a name="line201"></a>
<a name="line202"></a>/** Test one really large string using SHA512 */
<a name="line203"></a>function testHashing512Large() {
<a name="line204"></a>  // This test tends to time out on IE7.
<a name="line205"></a>  if (!goog.userAgent.IE || goog.userAgent.isVersionOrHigher(&#39;8&#39;)) {
<a name="line206"></a>    var hasher = new goog.crypt.Sha512();
<a name="line207"></a>    hasher.update(goog.array.repeat(0, 1000000));
<a name="line208"></a>    var digest = hasher.digest();
<a name="line209"></a>    var expected = goog.crypt.hexToByteArray(
<a name="line210"></a>        &#39;ce044bc9fd43269d5bbc946cbebc3bb711341115cc4abdf2edbc3ff2c57ad4b1&#39; +
<a name="line211"></a>        &#39;5deb699bda257fea5aef9c6e55fcf4cf9dc25a8c3ce25f2efe90908379bff7ed&#39;);
<a name="line212"></a>    assertElementsEquals(expected, digest);
<a name="line213"></a>  }
<a name="line214"></a>}
<a name="line215"></a>
<a name="line216"></a>
<a name="line217"></a>/** Check that the code throws an error for bad input */
<a name="line218"></a>function testBadInput_nullNotAllowed() {
<a name="line219"></a>  var hasher = new goog.crypt.Sha512();
<a name="line220"></a>  assertThrows(&#39;Null input not allowed&#39;, function() {
<a name="line221"></a>    hasher.update({});
<a name="line222"></a>  });
<a name="line223"></a>}
<a name="line224"></a>
<a name="line225"></a>function testBadInput_noFloatingPoint() {
<a name="line226"></a>  var hasher = new goog.crypt.Sha512();
<a name="line227"></a>  assertThrows(&#39;Floating point not allows&#39;, function() {
<a name="line228"></a>    hasher.update([1, 2, 3, 4, 4.5]);
<a name="line229"></a>  });
<a name="line230"></a>}
<a name="line231"></a>
<a name="line232"></a>function testBadInput_negativeNotAllowed() {
<a name="line233"></a>  var hasher = new goog.crypt.Sha512();
<a name="line234"></a>  assertThrows(&#39;Negative not allowed&#39;, function() {
<a name="line235"></a>    hasher.update([1, 2, 3, 4, -10]);
<a name="line236"></a>  });
<a name="line237"></a>}
<a name="line238"></a>
<a name="line239"></a>function testBadInput_mustBeByteArray() {
<a name="line240"></a>  var hasher = new goog.crypt.Sha512();
<a name="line241"></a>  assertThrows(&#39;Must be byte array&#39;, function() {
<a name="line242"></a>    hasher.update([1, 2, 3, 4, {}]);
<a name="line243"></a>  });
<a name="line244"></a>}
<a name="line245"></a>
<a name="line246"></a>function testBadInput_byteTooLarge() {
<a name="line247"></a>  var hasher = new goog.crypt.Sha512();
<a name="line248"></a>  assertThrows(&#39;&gt;255 not allowed&#39;, function() {
<a name="line249"></a>    hasher.update([1, 2, 3, 4, 256]);
<a name="line250"></a>  });
<a name="line251"></a>}
<a name="line252"></a>
<a name="line253"></a>function testBadInput_characterTooLarge() {
<a name="line254"></a>  var hasher = new goog.crypt.Sha512();
<a name="line255"></a>  assertThrows(&#39;&gt;255 not allowed&#39;, function() {
<a name="line256"></a>    hasher.update(&#39;abc&#39; + String.fromCharCode(256));
<a name="line257"></a>  });
<a name="line258"></a>}
<a name="line259"></a>
<a name="line260"></a>
<a name="line261"></a>function testHasherNeedsReset_beforeDigest() {
<a name="line262"></a>  var hasher = new goog.crypt.Sha512();
<a name="line263"></a>  hasher.update(&#39;abc&#39;);
<a name="line264"></a>  hasher.digest();
<a name="line265"></a>  assertThrows(&#39;Need reset after digest&#39;, function() {
<a name="line266"></a>    hasher.digest();
<a name="line267"></a>  });
<a name="line268"></a>}
<a name="line269"></a>
<a name="line270"></a>
<a name="line271"></a>function testHasherNeedsReset_beforeUpdate() {
<a name="line272"></a>  var hasher = new goog.crypt.Sha512();
<a name="line273"></a>  hasher.update(&#39;abc&#39;);
<a name="line274"></a>  hasher.digest();
<a name="line275"></a>  assertThrows(&#39;Need reset after digest&#39;, function() {
<a name="line276"></a>    hasher.update(&#39;abc&#39;);
<a name="line277"></a>  });
<a name="line278"></a>}
</pre>


</body>
</html>
