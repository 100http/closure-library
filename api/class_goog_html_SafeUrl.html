<!DOCTYPE html><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="Content-Language" content="en"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>SafeUrl</title><link href="dossier.css" rel="stylesheet" type="text/css"><header><div><form><div><input type="search" placeholder="Search"></div></form></div></header><main><article><div class="parentlink"><b>Namespace:</b> <a href="namespace_goog_html.html">goog.html</a></div><div class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l69">View Source</a></div><h1>class SafeUrl</h1><div class="tags"><span>final</span><span>struct</span></div><dl><dt>All implemented interfaces:<dd><code><a href="interface_goog_i18n_bidi_DirectionalString.html">goog.i18n.bidi.DirectionalString</a></code>, <code><a href="interface_goog_string_TypedString.html">goog.string.TypedString</a></code></dl><p>A string that is safe to use in URL context in DOM APIs and HTML documents.</p><p>A SafeUrl is a string-like object that carries the security type contract that its value as a string will not cause untrusted script execution when evaluated as a hyperlink URL in a browser.</p><p>Values of this type are guaranteed to be safe to use in URL/hyperlink contexts, such as, assignment to URL-valued DOM properties, or interpolation into a HTML template in URL context (e.g., inside a href attribute), in the sense that the use will not result in a Cross-Site-Scripting vulnerability.</p><p>Note that, as documented in <code>goog.html.SafeUrl.unwrap</code>, this type&#39;s contract does not guarantee that instances are safe to interpolate into HTML without appropriate escaping.</p><p>Note also that this type&#39;s contract does not imply any guarantees regarding the resource the URL refers to. In particular, SafeUrls are <b>not</b> safe to use in a context where the referred-to resource is interpreted as trusted code, e.g., as the src of a script tag.</p><p>Instances of this type must be created via the factory methods (<code>goog.html.SafeUrl.fromConstant</code>, <code>goog.html.SafeUrl.sanitize</code>), etc and not by invoking its constructor. The constructor intentionally takes no parameters and the type is immutable; hence only a default instance corresponding to the empty string can be obtained via constructor invocation.</p><h2>Instance Methods</h2><div id="getDirection" class="function"><div><h3>getDirection()<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l163">code »</a></span></h3><p>Returns this URLs directionality, which is always <code>LTR</code>.</p><p><b>Specified by: </b><a href="interface_goog_i18n_bidi_DirectionalString.html#getDirection">goog.i18n.bidi.DirectionalString</a></p><div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code>?<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">number</a></code></dl></div></div></div></div><hr class="fn-sep"><div id="getTypedStringValue" class="function"><div><h3>getTypedStringValue()<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l147">code »</a></span></h3><p>Returns this SafeUrl&#39;s value a string.</p><p>IMPORTANT: In code where it is security relevant that an object&#39;s type is indeed <code>SafeUrl</code>, use <code>goog.html.SafeUrl.unwrap</code> instead of this method. If in doubt, assume that it&#39;s security relevant. In particular, note that goog.html functions which return a goog.html type do not guarantee that the returned instance is of the right type. For example:</p>
<pre>
var fakeSafeHtml &#61; new String(&#39;fake&#39;);
fakeSafeHtml.__proto__ &#61; goog.html.SafeHtml.prototype;
var newSafeHtml &#61; goog.html.SafeHtml.htmlEscape(fakeSafeHtml);
// newSafeHtml is just an alias for fakeSafeHtml, it&#39;s passed through by
// goog.html.SafeHtml.htmlEscape() as fakeSafeHtml instanceof
// goog.html.SafeHtml.
</pre><p>IMPORTANT: The guarantees of the SafeUrl type contract only extend to the behavior of browsers when interpreting URLs. Values of SafeUrl objects MUST be appropriately escaped before embedding in a HTML document. Note that the required escaping is context-sensitive (e.g. a different escaping is required for embedding a URL in a style property within a style attribute, as opposed to embedding in a href attribute).</p><p><b>Specified by: </b><a href="interface_goog_string_TypedString.html#getTypedStringValue">goog.string.TypedString</a></p><div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code></dl></div></div></div></div><hr class="fn-sep"><div id="toString" class="function"><div><h3>toString()<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l178">code »</a></span></h3><p>Returns a debug string-representation of this value.</p><p>To obtain the actual string value wrapped in a SafeUrl, use <code>goog.html.SafeUrl.unwrap</code>.</p><div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code></dl></div></div></div></div><h2>Instance Properties</h2><div id="implementsGoogI18nBidiDirectionalString" class="property"><dl><dt><a href="source/closure/goog/html/safeurl.js.src.html#l156">implementsGoogI18nBidiDirectionalString</a><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean">boolean</a></code><dd>No description.</dl></div><div id="implementsGoogStringTypedString" class="property"><dl><dt><a href="source/closure/goog/html/safeurl.js.src.html#l116">implementsGoogStringTypedString</a><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean">boolean</a></code><dd>No description.</dl></div><h2>Static Functions</h2><div id="SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse" class="function"><div><h3>SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(<wbr>url)<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l393">code »</a></span></h3><p>Package-internal utility method to create SafeUrl instances.</p><div><div class="fn-details"><div><b>Parameters</b></div><dl><dt>url<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The string to initialize the SafeUrl object with.</p></dl></div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="class_goog_html_SafeUrl.html">goog.html.SafeUrl</a></code><dd><p>The initialized SafeUrl object.</p></dl></div></div></div></div><hr class="fn-sep"><div id="SafeUrl.fromBlob" class="function"><div><h3>SafeUrl.fromBlob(<wbr>blob)<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l265">code »</a></span></h3><p>Creates a SafeUrl wrapping a blob URL for the given <code>blob</code>.</p><p>The blob URL is created with <code>URL.createObjectURL</code>. If the MIME type for <code>blob</code> is not of a known safe image or video MIME type, then the SafeUrl will wrap <a href="class_goog_html_SafeUrl.html#SafeUrl.INNOCUOUS_STRING"><code>#INNOCUOUS_STRING</code></a>.</p><div><div class="fn-details"><div><b>Parameters</b></div><dl><dt>blob<code>Blob</code></dl></div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="class_goog_html_SafeUrl.html">goog.html.SafeUrl</a></code><dd><p>The blob URL, or an innocuous string wrapped  as a SafeUrl.</p></dl></div></div></div></div><hr class="fn-sep"><div id="SafeUrl.fromConstant" class="function"><div><h3>SafeUrl.fromConstant(<wbr>url)<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l236">code »</a></span></h3><p>Creates a SafeUrl object from a compile-time constant string.</p><p>Compile-time constant strings are inherently program-controlled and hence trusted.</p><div><div class="fn-details"><div><b>Parameters</b></div><dl><dt>url<code><a href="class_goog_string_Const.html">goog.string.Const</a></code><dd><p>A compile-time-constant string from which to  create a SafeUrl.</p></dl></div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="class_goog_html_SafeUrl.html">goog.html.SafeUrl</a></code><dd><p>A SafeUrl object initialized to <code>url</code>.</p></dl></div></div></div></div><hr class="fn-sep"><div id="SafeUrl.fromDataUrl" class="function"><div><h3>SafeUrl.fromDataUrl(<wbr>dataUrl)<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l289">code »</a></span></h3><p>Creates a SafeUrl wrapping a data: URL, after validating it matches a known-safe image or video MIME type.</p><div><div class="fn-details"><div><b>Parameters</b></div><dl><dt>dataUrl<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>A valid base64 data URL with one of the whitelisted  image or video MIME types.</p></dl></div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="class_goog_html_SafeUrl.html">goog.html.SafeUrl</a></code><dd><p>A matching safe URL, or <code>INNOCUOUS_STRING</code>  wrapped as a SafeUrl if it does not pass.</p></dl></div></div></div></div><hr class="fn-sep"><div id="SafeUrl.sanitize" class="function"><div><h3>SafeUrl.sanitize(<wbr>url)<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l361">code »</a></span></h3><p>Creates a SafeUrl object from <code>url</code>. If <code>url</code> is a goog.html.SafeUrl then it is simply returned. Otherwise the input string is validated to match a pattern of commonly used safe URLs. The string is converted to UTF-8 and non-whitelisted characters are percent-encoded. The string wrapped by the created SafeUrl will thus contain only ASCII printable characters.</p><p><code>url</code> may be a URL with the http, https, mailto or ftp scheme, or a relative URL (i.e., a URL without a scheme; specifically, a scheme-relative, absolute-path-relative, or path-relative URL).</p><p><code>url</code> is converted to UTF-8 and non-whitelisted characters are percent-encoded. Whitelisted characters are &#39;%&#39; and, from RFC 3986, unreserved characters and reserved characters, with the exception of &#39;&#39;&#39;, &#39;(&#39; and &#39;)&#39;. This ensures the the SafeUrl contains only ASCII-printable characters and reduces the chance of security bugs were it to be interpolated into a specific context without the necessary escaping.</p><p>If <code>url</code> fails validation or does not UTF-16 decode correctly (JavaScript strings are UTF-16 encoded), this function returns a SafeUrl object containing an innocuous string, goog.html.SafeUrl.INNOCUOUS_STRING.</p><div><div class="fn-details"><div><b>Parameters</b></div><dl><dt>url<code>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>|<a href="interface_goog_string_TypedString.html">goog.string.TypedString</a>)</code><dd><p>The URL to validate.</p></dl></div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="class_goog_html_SafeUrl.html">goog.html.SafeUrl</a></code><dd><p>The validated URL, wrapped as a SafeUrl.</p></dl></div></div></div></div><hr class="fn-sep"><div id="SafeUrl.unwrap" class="function"><div><h3>SafeUrl.unwrap(<wbr>safeUrl)<span class="codelink"><a href="source/closure/goog/html/safeurl.js.src.html#l202">code »</a></span></h3><p>Performs a runtime check that the provided object is indeed a SafeUrl object, and returns its value.</p><p>IMPORTANT: The guarantees of the SafeUrl type contract only extend to the behavior of browsers when interpreting URLs. Values of SafeUrl objects MUST be appropriately escaped before embedding in a HTML document. Note that the required escaping is context-sensitive (e.g. a different escaping is required for embedding a URL in a style property within a style attribute, as opposed to embedding in a href attribute).</p><div><div class="fn-details"><div><b>Parameters</b></div><dl><dt>safeUrl<code><a href="class_goog_html_SafeUrl.html">goog.html.SafeUrl</a></code><dd><p>The object to extract from.</p></dl></div><div class="fn-details"><div><b>Returns</b></div><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The SafeUrl object&#39;s contained string, unless the run-time  type check fails. In that case, <code>unwrap</code> returns an innocuous  string, or, if assertions are enabled, throws  <code>goog.asserts.AssertionError</code>.</p></dl></div></div></div></div><h2>Static Properties</h2><div id="SafeUrl.INNOCUOUS_STRING" class="property"><dl><dt><a href="source/closure/goog/html/safeurl.js.src.html#l109">SafeUrl.INNOCUOUS_STRING</a><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The innocuous string generated by goog.html.SafeUrl.sanitize when passed an unsafe URL.</p><p>about:invalid is registered in http://www.w3.org/TR/css3-values/#about-invalid. http://tools.ietf.org/html/rfc6694#section-2.2.1 permits about URLs to contain a fragment, which is not to be considered when determining if an about URL is well-known.</p><p>Using about:invalid seems preferable to using a fixed data URL, since browsers might choose to not report CSP violations on it, as legitimate CSS function calls to attr() can result in this URL being produced. It is also a standard URL which matches exactly the semantics we need: &#34;The about:invalid URI references a non-existent document with a generic error condition. It can be used when a URI is necessary, but the default value shouldn&#39;t be resolveable as any type of document&#34;.</p></dl></div></article><nav><h3><a href="index.html">Overview</a></h3><div><input type="checkbox" id="nav-types" checked/><label for="nav-types"><h3><span class="selectable">Types</span></h3></label><div id="nav-types-view"></div></div></nav></main><div class="pre-footer"><div></div></div><footer><div><a href="https://github.com/jleyba/js-dossier">Generated by dossier</a></div></footer><script src="types.js"></script><script src="dossier.js"></script>